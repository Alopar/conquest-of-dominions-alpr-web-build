<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conquest of Dominions</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/ui.css">
    <link rel="stylesheet" href="css/game.css">
    <link rel="stylesheet" href="css/screens.css">
</head>
<body>
    <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="intro-screen" class="screen active">
        <div class="intro-table-container">
            <table class="intro-table">
                <tr>
                    <td colspan="2">
                        <h1 style="font-size:3.5em; color:#cd853f; margin-bottom:32px; text-shadow:2px 2px 8px rgba(0,0,0,0.8); letter-spacing:3px; font-weight:600;">
                            <span style="font-size:1.1em; vertical-align:middle;">üè∞</span> Conquest of Dominions <span style="font-size:1.1em; vertical-align:middle;">‚öîÔ∏è</span>
                        </h1>
                    </td>
                </tr>
                <tr>
                    <td colspan="2">
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 16px; margin-top: 20px;">
                            <button class="btn" onclick="showAdventureSetup()" style="width: 220px; font-size:1.1em;">üó∫Ô∏è –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ</button>
                            <button class="btn" onclick="showFight()" style="width: 220px; font-size:1.1em;">‚öîÔ∏è –°—Ö–≤–∞—Ç–∫–∞</button>
                            <button class="btn" onclick="showBestiary()" style="width: 220px; font-size:1.1em;">üêâ –ë–µ—Å—Ç–∏–∞—Ä–∏–π</button>
                            <button class="btn" onclick="showSettings()" style="width: 220px; font-size:1.1em;">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                             <button class="btn" onclick="showRules()" style="width: 220px; font-size:1.1em;">üìú –ü—Ä–∞–≤–∏–ª–∞</button>
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –ü—Ä–∞–≤–∏–ª–∞ -->
    <div id="rules-screen" class="screen" style="display: none !important;">
        <div class="menu-bar">
            <div class="menu-left">
                <button class="btn" onclick="showIntro()">–ì–ª–∞–≤–Ω–∞—è</button>
            </div>
        </div>
        <div class="settings-container">
            <div class="settings-content">
                <h2>üìú –ü—Ä–∞–≤–∏–ª–∞</h2>
                <div class="rules-scroll bestiary-table-wrapper">
                    <div id="rules-content" class="rules-markdown">
                        –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∞–≤–∏–ª...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –°—Ö–≤–∞—Ç–∫–∞ -->
    <div id="fight-screen" class="screen" style="display: none !important;">
        <div class="menu-bar">
            <div class="menu-left">
                <button class="btn" onclick="backToIntroFromFight()">–ì–ª–∞–≤–Ω–∞—è</button>
            </div>
        </div>

        <div class="settings-container">
            <div class="settings-content">
                <h2>‚öîÔ∏è –°—Ö–≤–∞—Ç–∫–∞</h2>
                <div class="config-section">
                    <div class="config-info">
                        <h3 style="color: #cd853f; margin-bottom: 15px; text-shadow: 1px 1px 2px rgba(0,0,0,0.6);">
                            ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—è
                        </h3>
                        <div id="file-status" class="file-status"></div>
                    </div>

                    <div class="config-actions">
                        <div class="action-group">
                            <label for="config-file" class="file-label">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:</label>
                            <label for="config-file" class="custom-file-btn" id="custom-file-btn">üìÅ –í–´–ë–†–ê–¢–¨ –§–ê–ô–õ</label>
                            <input type="file" id="config-file" accept=".json" class="file-input">
                        </div>

                        <div class="action-group">
                            <button class="btn secondary-btn" onclick="downloadSampleConfig()" style="width: 200px;">
                                üì• –û–ë–†–ê–ó–ï–¶
                            </button>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 20px; justify-content: center; margin-top: 10px;">
                    <button class="btn" id="battle-btn" onclick="startBattle()" disabled style="width: 250px; font-size:1.15em;">
                        üö© –ù–∞—á–∞—Ç—å –±–æ–π! üö©
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è: –∑–∞–≥—Ä—É–∑–∫–∞ -->
    <div id="adventure-setup-screen" class="screen" style="display: none !important;">
        <div class="menu-bar">
            <div class="menu-left">
                <button class="btn" onclick="backToIntroFromAdventure()">–ì–ª–∞–≤–Ω–∞—è</button>
            </div>
        </div>
        <div class="settings-container">
            <div class="settings-content">
                <h2>üó∫Ô∏è –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ</h2>
                <div class="config-section">
                    <div class="config-info">
                        <h3 style="color: #cd853f; margin-bottom: 15px; text-shadow: 1px 1px 2px rgba(0,0,0,0.6);">
                            ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è
                        </h3>
                        <div id="adventure-file-status" class="file-status"></div>
                    </div>
                        <div class="config-actions">
                        <div class="action-group">
                            <label for="adventure-file" class="file-label">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è:</label>
                            <label for="adventure-file" class="custom-file-btn" id="adventure-custom-file-btn">üìÅ –í–´–ë–†–ê–¢–¨ –§–ê–ô–õ</label>
                            <input type="file" id="adventure-file" accept=".json" class="file-input">
                        </div>
                        <div class="action-group">
                            <button class="btn secondary-btn" onclick="downloadSampleAdventureConfig()" style="width: 200px;">
                                üì• –û–ë–†–ê–ó–ï–¶
                            </button>
                        </div>
                    </div>
                </div>
                <div style="display: flex; gap: 20px; justify-content: center; margin-top: 10px;">
                    <button class="btn" id="adventure-begin-btn" onclick="beginAdventureFromSetup()" disabled style="width: 350px; font-size:1.15em;">
                        üìØ –ù–∞—á–∞—Ç—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ! üìØ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è: –æ—Å–Ω–æ–≤–Ω–æ–π -->
    <div id="adventure-screen" class="screen" style="display: none !important;">
        <div class="menu-bar">
            <div class="menu-left">
                <button class="btn" onclick="backToIntroFromAdventure()">–ì–ª–∞–≤–Ω–∞—è</button>
            </div>
        </div>
        <div class="settings-container">
            <div class="settings-content">
                <h2>üó∫Ô∏è –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ</h2>
                <div id="adventure-summary" style="margin-bottom: 10px;"></div>
                <div class="settings-layout">
                    <div class="settings-section">
                        <h3>–†–µ—Å—É—Ä—Å—ã</h3>
                        <div style="font-size:1.1em">–ó–æ–ª–æ—Ç–æ: <span id="adventure-gold">0</span> üí∞</div>
                    </div>
                    <div class="settings-section">
                        <h3>–ê—Ä–º–∏—è –∏–≥—Ä–æ–∫–∞</h3>
                        <div id="adventure-pool" class="bestiary-table-wrapper"></div>
                    </div>
                </div>
                <div class="settings-layout">
                    <div class="settings-section">
                        <h3>–ú–∞–≥–∞–∑–∏–Ω –Ω–∞–µ–º–Ω–∏–∫–æ–≤</h3>
                        <div class="bestiary-table-wrapper">
                            <table class="bestiary-table unit-info-table">
                                <thead>
                                    <tr>
                                        <th class="icon-cell">üë§</th>
                                        <th>–ò–º—è</th>
                                        <th>ID</th>
                                        <th>–¶–µ–Ω–∞</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="adventure-shop-table">
                                    <tr><td colspan="5">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="settings-section">
                        <h3>–°–ª–µ–¥—É—é—â–∞—è –≤—Å—Ç—Ä–µ—á–∞</h3>
                        <div id="adventure-encounter"></div>
                        <div style="margin-top: 12px; display:flex; justify-content:center;">
                            <button class="btn" id="adventure-start-btn" onclick="startAdventureBattle()" disabled style="width: 250px; font-size:1.05em;">üö© –ù–∞—á–∞—Ç—å –±–æ–π üö©</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è -->
    <div id="adventure-result-screen" class="screen" style="display: none !important;">
        <div class="menu-bar">
            <div class="menu-left"></div>
        </div>
        <div class="settings-container">
            <div class="settings-content" style="text-align:center;">
                <h2>üß≠ –ò—Ç–æ–≥–∏ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è</h2>
                <div id="adventure-result-message" style="font-size:1.2em; margin: 16px 0 24px 0;"></div>
                <div style="display:flex; justify-content:center;">
                    <button class="btn" onclick="showIntro()" style="width: 220px; font-size:1.05em;">–ù–∞ –≥–ª–∞–≤–Ω—ã–π</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –±–æ—è -->
    <div id="battle-screen" class="screen" style="display: none !important;">
        <div class="menu-bar">
            <div class="menu-left">
                <button class="btn" id="battle-btn-home" onclick="showIntro()">–ì–ª–∞–≤–Ω–∞—è</button>
            </div>
        </div>
        
        <div class="main-content">
            <div class="battlefield-container">
                <div class="battlefield-content">
                    <div class="battle-info">
                        <h2>–ü–æ–ª–µ –±–æ—è</h2>
                        <div id="battle-status">–ë–æ–π –≥–æ—Ç–æ–≤ –∫ –Ω–∞—á–∞–ª—É</div>
                        <div class="turn-info">
                            <div id="turn-counter">–•–æ–¥: 1</div>
                        </div>
                    </div>
                    
                    <div class="army-label" id="defenders-label">–ó–∞—â–∏—Ç–Ω–∏–∫–∏</div>
                    <div id="defenders-line" class="army-line"></div>
                    
                    <div class="army-label" id="attackers-label">–ê—Ç–∞–∫—É—é—â–∏–µ</div>
                    <div id="attackers-line" class="army-line"></div>
                    
                    <div class="controls">
                        <button class="btn" onclick="step()" id="step-btn">‚è≥ –®–∞–≥</button>
                        <button class="btn" onclick="nextTurn()" id="next-turn-btn">üîÑ –•–æ–¥</button>
                        <div style="display:flex; gap:12px; justify-content:center; margin-top:10px;">
                            <button class="btn" id="battle-finish-btn" onclick="finishBattleToAdventure()" style="display:none;">üó∫Ô∏è –ó–∞–≤–µ—Ä—à–∏—Ç—å –±–æ–π</button>
                            <button class="btn" id="battle-retry-btn" onclick="retryBattle()" style="display:none;">‚öîÔ∏è –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –±–æ–π</button>
                        </div>
                    </div>
                </div>
                
                <!-- –ü–ª–∞—à–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —é–Ω–∏—Ç–µ -->
                <div id="unit-info-panel" class="unit-info-panel">
                    <table class="unit-info-table">
                        <tr>
                            <td class="unit-info-label"><span class="unit-info-value" id="unit-name"></span></td>
                            <td class="unit-info-label">–¢–ò–ü: <span class="unit-info-value" id="unit-type"></span></td>
                            <td class="unit-info-label">HP: <span class="unit-info-value" id="unit-hp"></span> ‚ù§Ô∏è</td>
                            <td class="unit-info-label">–£–†–û–ù: <span class="unit-info-value" id="unit-damage"></span> üí•</td>
                            <td class="unit-info-label">–¶–ï–õ–ò: <span class="unit-info-value" id="unit-targets"></span> üéØ</td>
                            <td class="unit-info-label">–°–¢–ê–¢–£–°: <span class="unit-info-value" id="unit-status"></span></td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="log-panel">
                <h3>–õ–æ–≥ –±–æ—è</h3>
                <div id="battle-log"></div>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="settings-screen" class="screen" style="display: none !important;">
        <div class="menu-bar">
            <div class="menu-left">
                <button class="btn" onclick="showIntro()">–ì–ª–∞–≤–Ω–∞—è</button>
            </div>
        </div>
        
        <div class="settings-container">
            <div class="settings-content">
                <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–≥—Ä—ã</h2>
                
                <div class="settings-layout">
                    <div class="settings-section">
                        <h3>–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                        <div class="setting-group">
                            <input type="number" id="maxUnitsPerArmy" min="1" max="20" value="10">
                            <label for="maxUnitsPerArmy">–ú–∞–∫—Å–∏–º—É–º —é–Ω–∏—Ç–æ–≤ –≤ –∞—Ä–º–∏–∏</label>
                        </div>
                        <div class="setting-group">
                            <input type="number" id="meleeHitThreshold" min="1" max="20" value="5">
                            <label for="meleeHitThreshold">–ü–æ—Ä–æ–≥ –ø–æ–ø–∞–¥–∞–Ω–∏—è (melee)</label>
                        </div>
                        <div class="setting-group">
                            <input type="number" id="rangeHitThreshold" min="1" max="20" value="11">
                            <label for="rangeHitThreshold">–ü–æ—Ä–æ–≥ –ø–æ–ø–∞–¥–∞–Ω–∏—è (range)</label>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h3>
                        <div class="setting-group">
                            <div class="custom-checkbox">
                                <input type="checkbox" id="showDetailedLog" checked>
                                <label for="showDetailedLog">–ü–æ–¥—Ä–æ–±–Ω—ã–π –ª–æ–≥</label>
                            </div>
                        </div>
                        <div class="setting-group">
                            <div class="custom-checkbox">
                                <input type="checkbox" id="attackAlternate" checked>
                                <label for="attackAlternate">–ê—Ç–∞–∫–∞ –ø–æ –æ—á–µ—Ä–µ–¥–∏</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button class="btn" onclick="saveSettings()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button class="btn secondary-btn" onclick="resetSettings()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

        <!-- –≠–∫—Ä–∞–Ω –ë–µ—Å—Ç–∏–∞—Ä–∏–π -->
    <div id="bestiary-screen" class="screen" style="display: none !important;">
        <div class="menu-bar">
            <div class="menu-left">
                <button class="btn" onclick="backToIntroFromBestiary()">–ì–ª–∞–≤–Ω–∞—è</button>
            </div>
        </div>
        
        <div class="settings-container">
            <div class="settings-content">
                <h2>üêâ –ë–µ—Å—Ç–∏–∞—Ä–∏–π</h2>
                <div style="margin-bottom: 18px; display: flex; gap: 18px; justify-content: center;">
                    <input type="file" id="monsters-file" accept=".json" style="display:none" onchange="uploadMonstersConfigFile(this)">
                    <button class="btn" onclick="document.getElementById('monsters-file').click()">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥</button>
                    <button class="btn secondary-btn" onclick="downloadMonstersConfig()">üíæ –°–∫–∞—á–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥</button>
                </div>
                <div class="bestiary-table-wrapper">
                    <table class="bestiary-table unit-info-table">
                        <thead>
                            <tr>
                                <th class="icon-cell">üë§</th>
                                <th>–ò–º—è</th>
                                <th>ID</th>
                                <th>–¢–∏–ø</th>
                                <th>‚ù§Ô∏è HP</th>
                                <th>üí• –£—Ä–æ–Ω</th>
                                <th>üéØ –¶–µ–ª–∏</th>
                            </tr>
                        </thead>
                        <tbody id="bestiary-table">
                            <tr><td colspan="7">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JavaScript —Ñ–∞–π–ª–æ–≤ -->
    <script src="js/monsters.js"></script>
    <script src="js/bestiary.js"></script>
    <script src="js/config.js"></script>
    <script src="js/settings.js"></script>
    <script src="js/game.js"></script>
    <script src="js/adventure.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>
</html>